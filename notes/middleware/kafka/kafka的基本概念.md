### 一、Kafka是什么

它是一个分布式，支持多分区、多副本，基于Zookeeper的分布式消息流的平台，同时也是一个基于发布订阅模式的消息中间件

### 二、Kafka主要概念

**消息**：Kafka中的数据单元是消息，也被称之记录，可以看成表的一行记录或者文件夹的文件

**主题**：消息的种类即是主题，主题类似数据表或者文件夹，是对消息进行分类

**批次**：一组消息，可以看成多行记录，主要是为了提高效率，消息会分批次写入Kafka

**分区(partition)**：主题可以被分成多个分区，相同主题的分区可以不在同一个机器上，单一主题的分区中消息是有序的，但是无法保证主题中的所有分区都是有序的

<div align="center">  <img src="https://i.bmp.ovh/imgs/2021/06/de2c94aee42184f7.png" width="600"/> </div><br>

**生产者**：生产者是向Kafka中写消息的客户端应用程序

**消费者**：消费者是订阅这些消息的客户端应用程序，在Kafka中生产者和消费者是完全解耦的

**消费者组**：一个或者多个消费者构成的群体，提高整体的消费能力，但是如果群组的消费者数量大于分区数量就会出现消费者过剩的情况

<div align="center">  <img src="https://i.bmp.ovh/imgs/2021/06/491325c162d55794.png" width="600"/> </div><br>

**偏移量**：是一个不断递增的数值，创建消息的时候，Kafka就会将其添加到其中，同一分区中的偏移量是唯一的，消费者进行消费消息的时候，会往主题是_cousume_offset发送消息(每个分区的偏移量)，当发生重平衡的时候，消费者通过读取每个分区最后一次提交的偏移量继续处理

**broker：**一台独立的Kafka服务器被称之为一个broker，接收生产者的消息，为消息设置偏移量，并且将消息存储到磁盘中

**副本**：Kafka中消息的备份是副本，副本的数量不是固定，只要有主副本和从副本，主副本对外提供服务，从副本被动跟随保持集群的高可用

### 三、Kafka主要特点

**高吞吐、低延迟**：Kafka每秒处理的消息可达几十万条，延迟只有几毫秒

**高伸缩**：每一个主题可以包括多个分区，每一个分区可以在不同的机器上

**持久性**：每一个partition的消息直接被追加到 append-only日志的尾部

**容错性**：集群中的某一个节点失败了，整个集群还能正常工作

**高并发**：多个客户端可以同时读写

### 四、Kafka使用场景

异步处理，应用解耦，流量削锋和消息通讯

**网站行为跟踪**：跟踪用户浏览页面、搜索及其他行为，以发布-订阅的模式实时记录到对应的topic里。那么这些结果被订阅者拿到后，就可以做进一步的实时处理，或实时监控，或放到hadoop/离线数据仓库里处理。

**指标**：用Kafka采集应用程序和服务器健康相关的指标，如CPU占用率、IO、内存、连接数、TPS、QPS等，然后将指标信息进行处理，从而构建一个具有监控仪表盘、曲线图等可视化监控系统。

**日志聚合**：日志聚合一般来说是从服务器上收集日志文件，然后放到一个集中的位置（文件服务器或HDFS）进行处理。

**限流削峰**：互联网领域某一时刻请求特别多的情况下，可以把请求写入Kafka 中，避免直接请求后端程序导致服务崩溃。

### 五、Kafka系统架构

<div align="center">  <img src="https://i.bmp.ovh/imgs/2021/06/82981c8336426e12.png" width="600"/> </div><br>

